!function(V,h){"use strict";var a="ht",q=a+".layout.",d=V[a]||module.parent.exports.ht,k=d.List,F=d.DataModel,Z=d.Node,v=d.Edge,I=d.Group,E=Math,R=E.sqrt,t=E.random,J=E.max,M=E.min,C=function(a){return a*a};d.Default.getInternal().addMSMap({ms_force:function(h){h._interval=50,h._stepCount=10,h._motionLimit=.01,h._edgeRepulsion=.65,h._nodeRepulsion=.65,h._damper=1,h._maxMotion=0,h._motionRatio=0,h.init=function(b){var E=this;b instanceof F?E.dm=b:E.gv=b,E._nodeMap={},E._nodes=new k,E._edges=new k},h.start=function(){var h=this,c=h.gv;if(!h._timer){var n=h.cdm=c?c.dm():h.dm;n.mm(h.handleDataModelChange,h),n.md(h.handleDataPropertyChange,h),c&&c.mp(h.handleGV,h),n.each(function(c){if(h.isVisible(c)&&h.isLayoutable(c)&&c instanceof Z)if(h instanceof K){var V=c.p3();c.p3([V[0]+t(),V[1]+t(),V[2]+t()])}else V=c.p(),c.p(V.x+t(),V.y+t())}),h._timer=setInterval(function(){h.relax()},h._interval),h._damper=1}},h.stop=function(){var x=this;x._timer&&(x.cdm.umm(x.handleDataModelChange,x),x.cdm.umd(x.handleDataPropertyChange,x),x.gv&&x.gv.ump(x.handleGV,x),clearInterval(x._timer),delete x._timer,delete x.cdm)},h.handleGV=function(y){var Y=this;if("dataModel"===y.property){var H=y.oldValue,F=y.newValue;H&&(H.umm(Y.handleDataModelChange,Y),H.umd(Y.handleDataPropertyChange,Y)),this.cdm=F,F.mm(Y.handleDataModelChange,Y),F.md(Y.handleDataPropertyChange,Y)}},h.relax=function(){var I=this;if(!(I._damper<.1&&I._maxMotion<I._motionLimit)){this.cdm.each(function(S){I.isVisible(S)&&(S instanceof v?I.addEdge(S):S instanceof Z&&I.addNode(S))});for(var k,K,w=0,r=I._edges,e=I._nodes,n=e.size();w<I._stepCount;w++){for(r.each(I.relaxEdge,I),k=0;n>k;k++)for(K=0;n>K;K++)I.relaxNode(e.get(k),e.get(K));I.moveNode()}I._isAdjusting=1,e.each(function(L){L.fix||(L.p?L.v.p3(L.p):L.v.p(L.x,L.y))}),delete I._isAdjusting,I._nodeMap={},e.clear(),r.clear(),I.onRelaxed()}},h.onRelaxed=function(){},h.isRunning=function(){return!!this._timer},h.isVisible=function(Q){return Q.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(Q):!0},h.isLayoutable=function(T){if(T.s("layoutable")===!1)return!1;if(T instanceof I)return!1;var h=this;return h.gv?h.gv.isMovable(T)&&!h.gv.isSelected(T):!(h.cdm||h.dm).sm().co(T)},h.getNodeRepulsion=function(){return this._nodeRepulsion},h.setNodeRepulsion=function(j){this._nodeRepulsion=j,this._damper=1},h.getEdgeRepulsion=function(){return this._edgeRepulsion},h.setEdgeRepulsion=function(H){this._edgeRepulsion=H,this._damper=1},h.getStepCount=function(){return this._stepCount},h.setStepCount=function(Q){this._stepCount=Q,this._damper=1},h.getInterval=function(){return this._interval},h.setInterval=function(B){var j=this;j._interval!==B&&(j._interval=B,j._timer&&(clearInterval(j._timer),j._timer=setInterval(function(){j.relax()},B)))},h.handleDataPropertyChange=function(D){!this._isAdjusting&&this.isVisible(D.data)&&(this._damper=1)},h.handleDataModelChange=function(){this._damper=1},h.damp=function(){var x=this._maxMotion,w=this._damper;this._motionRatio<=.001&&((.2>x||x>1&&.9>w)&&w>.01?this._damper-=.01:.4>x&&w>.003?this._damper-=.003:w>1e-4&&(this._damper-=1e-4)),x<this._motionLimit&&(this._damper=0)}}}),d.layout.ForceLayout=function(t){this.init(t)},d.Default.def(q+"ForceLayout",h,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(u){this._limitBounds=u,this._damper=1},getNodeSize:function(k){var s=this.gv;return s&&s.getDataUIBounds?s.getDataUIBounds(k):k.getRect()},addNode:function($){var D=this,V=D._nodeMap[$._id];if(V)return V;var v=$.p();V={v:$,x:v.x,y:v.y,dx:0,dy:0,fix:!D.isLayoutable($),s:D.getNodeSize($)};var J=V.s,P=R(C(J.width)+C(J.height))*D._nodeRepulsion;return V.r=1>P?100:P,D._nodeMap[$._id]=V,D._nodes.add(V),V},addEdge:function(h){if(h._40I&&h._41I){var j=this,g=j.addNode(h._40I),a=j.addNode(h._41I),H={s:g,t:a};a=a.s,g=g.s;var l=a.width+g.width,T=a.height+g.height;H.length=R(l*l+T*T)*j._edgeRepulsion,H.length<=0&&(H.length=100),j._edges.add(H)}},relaxEdge:function(L){var M=L.t,g=L.s,D=M.x-g.x,x=M.y-g.y,q=R(D*D+x*x),A=100*L.length,c=.25*D/A*q,v=.25*x/A*q;M.dx=M.dx-c,M.dy=M.dy-v,g.dx=g.dx+c,g.dy=g.dy+v},relaxNode:function(W,Z){if(W!==Z){var v=0,r=0,L=W.x-Z.x,Y=W.y-Z.y,V=L*L+Y*Y;0===V?(v=t(),r=t()):36e4>V&&(v=L/V,r=Y/V);var N=W.r*Z.r/400;v*=N,r*=N,W.dx+=v,W.dy+=r,Z.dx-=v,Z.dy-=r}},moveNode:function(){var f=this,q=f._limitBounds,U=f._maxMotion,p=0,K=f._damper;f._nodes.each(function(x){if(!x.fix){var s=x.dx*K,o=x.dy*K;if(x.dx=s/2,x.dy=o/2,p=J(R(s*s+o*o),p),x.x+=J(-40,M(40,s)),x.y+=J(-40,M(40,o)),q){x.x<q.x&&(x.x=q.x,f.adjust(1,0)),x.y<q.y&&(x.y=q.y,f.adjust(0,1));var r=x.s;x.x+r.width>q.x+q.width&&(x.x=q.x+q.width-r.width,f.adjust(-1,0)),x.y+r.height>q.y+q.height&&(x.y=q.y+q.height-r.height,f.adjust(0,-1))}}}),f._maxMotion=p,f._motionRatio=p>0?U/p-1:0,f.damp()},adjust:function(a,u){var O=this._limitBounds;this._nodes.each(function(B){a>0?(!O||B.x+B.s.width+a<O.x+O.width)&&(B.x+=a):(!O||B.x+a>O.x)&&(B.x+=a),u>0?(!O||B.y+B.s.height+u<O.y+O.height)&&(B.y+=u):(!O||B.y+u>O.y)&&(B.y+=u)})}});var K=d.layout.Force3dLayout=function(g){this.init(g)};d.Default.def(q+"Force3dLayout",h,{ms_force:1,getNodeSize3d:function(w){return w.s3()},addNode:function(j){var Y=this,G=Y._nodeMap[j._id];if(G)return G;G={v:j,p:j.p3(),d:[0,0,0],fix:!Y.isLayoutable(j),s:Y.getNodeSize3d(j)};var n=G.s,U=d.Default.getDistance(n)*Y._nodeRepulsion;return G.r=1>U?100:U,Y._nodeMap[j._id]=G,Y._nodes.add(G),G},addEdge:function(M){if(M._40I&&M._41I){var L=this,f=L.addNode(M._40I),G=L.addNode(M._41I),W={s:f,t:G};G=G.s,f=f.s,W.length=R(C(G[0]+f[0])+C(G[1]+f[1])+C(G[2]+f[2]))*L._edgeRepulsion,W.length<=0&&(W.length=100),L._edges.add(W)}},relaxEdge:function(C){var i=C.t.p,v=C.s.p,s=C.t.d,K=C.s.d,F=i[0]-v[0],A=i[1]-v[1],P=i[2]-v[2],h=R(F*F+A*A+P*P),E=100*C.length,J=.25*F/E*h,I=.25*A/E*h,W=.25*P/E*h;s[0]-=J,s[1]-=I,s[2]-=W,K[0]+=J,K[1]+=I,K[2]+=W},relaxNode:function(Q,j){if(Q!==j){var J=Q.p,z=j.p,Z=0,r=0,A=0,H=J[0]-z[0],s=J[1]-z[1],Y=J[2]-z[2],v=H*H+s*s+Y*Y;0===v?(Z=t(),r=t(),A=t()):216e6>v&&(Z=H/v,r=s/v,A=Y/v);var X=Q.r*j.r/400,o=Q.d,l=j.d;Z*=X,r*=X,A*=X,o[0]+=Z,o[1]+=r,o[2]+=A,l[0]-=Z,l[1]-=r,l[2]-=A}},moveNode:function(){var G=this,h=G._maxMotion,A=0,z=G._damper;G._nodes.each(function(L){if(!L.fix){var f=L.p,n=L.d,t=n[0]*z,W=n[1]*z,y=n[2]*z;n[0]=t/2,n[1]=W/2,n[2]=y/2,A=J(R(t*t+W*W+y*y),A),f[0]+=J(-40,M(40,t)),f[1]+=J(-40,M(40,W)),f[2]+=J(-40,M(40,y))}}),G._maxMotion=A,G._motionRatio=A>0?h/A-1:0,G.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);