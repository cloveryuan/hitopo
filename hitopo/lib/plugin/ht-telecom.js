!function(q,p){"use strict";var e=ht.AlarmSeverity=function(M,V,e,$,T){this.value=M,this.name=V,this.nickName=e,this.color=$,this.displayName=T};ht.Default.def("ht.AlarmSeverity",p,{toString:function(){return this.displayName||this.name}}),function(){e.severities=new ht.List,e._vm={},e._nm={},e._cp=function(l,$){if(l&&$){var N=l.value-$.value;return N>0?1:0>N?-1:0}return l&&!$?1:!l&&$?-1:0},e.each=function(M,Q){e.severities.each(M,Q)},e.getSortFunction=function(){return e._cp},e.setSortFunction=function(K){e._cp=K,e.severities.sort(K)},e.add=function(I,_,U,W,d){var X=new e(I,_,U,W,d);return e._vm[I]=X,e._nm[_]=X,e.severities.add(X),e.severities.sort(e._cp),X},e.remove=function(g){var A=e._nm[g];return A&&(delete e._nm[g],delete e._vm[A.value],e.severities.remove(A)),A},e.CRITICAL=e.add(500,"Critical","C","#FF0000"),e.MAJOR=e.add(400,"Major","M","#FFA000"),e.MINOR=e.add(300,"Minor","m","#FFFF00"),e.WARNING=e.add(200,"Warning","W","#00FFFF"),e.INDETERMINATE=e.add(100,"Indeterminate","N","#C800FF"),e.CLEARED=e.add(0,"Cleared","R","#00FF00"),e.isClearedAlarmSeverity=function(q){return q?0===q.value:!1},e.getByName=function(Q){return e._nm[Q]},e.getByValue=function(S){return e._vm[S]},e.clear=function(){e.severities.clear(),e._vm={},e._nm={}},e.compare=function(b,P){return e._cp(b,P)}}();var d=ht.AlarmState=function(C){this._d=C,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",p,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var v=null;for(var u in this._am)u=e.getByName(u),e.isClearedAlarmSeverity(u)||0!==this.getAcknowledgedAlarmCount(u)&&(v=v?e.compare(v,u)>0?v:u:u);this._haa=v},_c2:function(){var T=null;for(var z in this._nm)z=e.getByName(z),e.isClearedAlarmSeverity(z)||0!==this.getNewAlarmCount(z)&&(T=T?e.compare(T,z)>0?T:z:z);this._hna=T},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var V in this._nm)if(V=e.getByName(V),!e.isClearedAlarmSeverity(V)&&0!==this.getNewAlarmCount(V)&&e.compare(this._hna,V)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var r=this._haa,X=this._hna,w=this._ps;this._hoa=r,e.compare(X,this._hoa)>0&&(this._hoa=X),e.compare(w,this._hoa)>0&&(this._hoa=w)},_c5:function(){var B=this._haa,N=this._hna;this._hta=B,e.compare(N,this._hta)>0&&(this._hta=N)},increaseAcknowledgedAlarm:function(r,I){if(0!==I){I=I||1;var h=this._am[r.name]||0;h+=I,this._am[r.name]=h,this._f()}},increaseNewAlarm:function(n,m){if(0!==m){m=m||1;var W=this._nm[n.name]||0;W+=m,this._nm[n.name]=W,this._f()}},decreaseAcknowledgedAlarm:function(T,x){if(0!==x){x||(x=1);var w=this._am[T.name]||0;if(w-=x,0>w)throw"Alarm count can not be negative";this._am[T.name]=w,this._f()}},decreaseNewAlarm:function(K,t){if(0!==t){t||(t=1);var P=this._nm[K.name]||0;if(P-=t,0>P)throw"Alarm count can not be negative";this._nm[K.name]=P,this._f()}},acknowledgeAlarm:function(Z){this.decreaseNewAlarm(Z,1),this.increaseAcknowledgedAlarm(Z,1)},acknowledgeAllAlarms:function(W){if(W){var $=this.getNewAlarmCount(W);this.decreaseNewAlarm(W,$),this.increaseAcknowledgedAlarm(W,$)}else for(var r in this._nm)this.acknowledgeAllAlarms(e.getByName(r))},_c6:function(){this._aac=0;for(var h in this._am)h=e.getByName(h),this._aac+=this.getAcknowledgedAlarmCount(h)},getAcknowledgedAlarmCount:function(x){return x?this._am[x.name]||0:this._aac},getAlarmCount:function(u){return this.getAcknowledgedAlarmCount(u)+this.getNewAlarmCount(u)},_c7:function(){this._nac=0;for(var x in this._nm)this._nac+=this.getNewAlarmCount(e.getByName(x))},getNewAlarmCount:function(H){return H?this._nm[H.name]||0:this._nac},setNewAlarmCount:function(B,O){this._nm[B.name]=O,this._f()},removeAllNewAlarms:function(o){o?delete this._nm[o]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(E,M){this._am[E.name]=M,this._f()},removeAllAcknowledgedAlarms:function(y){y?delete this._am[y.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(R){if(this._ep||(R=null),this._ps!==R){var w=this._ps;this._ps=R,this._f(),this._d.fp("propagateSeverity",w,R)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(W){var i=this._ep;this._ep=W,this._d.fp("enablePropagation",i,W)&&(W||this.setPropagateSeverity(null))}});var B=ht.AlarmStatePropagator=function(L){this._dataModel=L,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",p,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(M){this._enable!==M&&(this._enable=M,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(E){this.propagate(E)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(s){s.data&&this.propagate(s.data)},handleDataPropertyChange:function(o){if("alarmState"===o.property||"enablePropagation"===o.property)this.propagate(o.data);else if("parent"===o.property){var Y=o.oldValue;Y&&this.propagate(Y),this.propagate(o.data)}},propagate:function(R){R&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(R),this._isPropagating=!1)},propagateToTop:function(T){for(this.propagateToParent(null,T);T&&T.getParent();)this.propagateToParent(T,T.getParent()),T=T.getParent()},propagateToParent:function(U,F){var g=null;F.getChildren().each(function(I){var t=I.getAlarmState().getHighestOverallAlarmSeverity();e.compare(t,g)>0&&(g=t)}),F.getAlarmState().setPropagateSeverity(g)}}),ht.AlarmStateStatistics=function(Y){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(Y)},ht.Default.def("ht.AlarmStateStatistics",p,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(J){var P=this._dataModel;P!==J&&(P&&(P.umd(this.handleDataPropertyChange,this),P.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=J,this.reset(),J.md(this.handleDataPropertyChange,this),J.mm(this.handleDataModelChange,this),this.fp("dataModel",P,J))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(k){"alarmState"===k.property&&(this.increase(k.data),this.fireAlarmStateChange())},handleDataModelChange:function(V){"add"===V.kind?(this.increase(V.data),this.fireAlarmStateChange()):"remove"===V.kind?(this.decrease(V.data),this.fireAlarmStateChange()):"clear"===V.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,e.each(function(Z){var X=this.getSumInfo(Z);this.sumAcked+=X.ackedCount,this.sumNew+=X.newCount,this.sumTotal+=X.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(g){if(!g)return this.sumNew;var b=this.getSumInfo(g);return b.newCount},getAcknowledgedAlarmCount:function(o){if(!o)return this.sumAcked;var N=this.getSumInfo(o);return N.ackedCount},getTotalAlarmCount:function(o){if(!o)return this.sumTotal;var t=this.getSumInfo(o);return t.totalCount},getSumInfo:function(Z){var K=this.severtiyMap[Z.name];return K||(K={},K.newCount=0,K.ackedCount=0,K.totalCount=0,this.severtiyMap[Z.name]=K),K},decrease:function(o){var h=this.dataMap[o.getId()];h&&(delete this.dataMap[o.getId()],e.each(function(X){var R=h[X.name],E=this.getSumInfo(X);E.newCount=E.newCount-R.newCount,E.ackedCount=E.ackedCount-R.ackedCount,E.totalCount=E.totalCount-R.totalCount},this))},increase:function(X){if(this.decrease(X),!this._filterFunc||this._filterFunc(X)){var B={},E=X.getAlarmState();this.dataMap[X.getId()]=B,e.each(function(g){var z={};z.newCount=E.getNewAlarmCount(g),z.ackedCount=E.getAcknowledgedAlarmCount(g),z.totalCount=E.getAlarmCount(g),B[g.name]=z;var I=this.getSumInfo(g);I.newCount=I.newCount+z.newCount,I.ackedCount=I.ackedCount+z.ackedCount,I.totalCount=I.totalCount+z.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(Y){var y=this._filterFunc;this._filterFunc=Y,this.reset(),this.fp("filterFunc",y,Y)},getFilterFunc:function(){return this._filterFunc}});var Z=ht.Data.prototype;Z.getAlarmState=function(){return this._alarmState||(this._alarmState=new d(this))},Z=ht.DataModel.prototype,Z.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},Z.setEnableAlarmStatePropagator=function(X){X!=this.isEnableAlarmStatePropagator()&&(X?(this._alarmStatePropagator=new B(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},Z=ht.graph.GraphView.prototype,Z.getNote2=function(r){var g=r.getAlarmState().getHighestNewAlarmSeverity();if(g){var o=r.getAlarmState().getNewAlarmCount(g)+g.nickName;return r.getAlarmState().hasLessSevereNewAlarms()&&(o+="+"),o}return r.s("note2")},Z.getNote2Background=function(U){var R=U.getAlarmState().getHighestNewAlarmSeverity();return R?R.color:U.s("note2.background")},Z.getBodyColor=function(P){var w=P.getAlarmState().getHighestNativeAlarmSeverity();return w?w.color:P.s("body.color")},Z.getBorderColor=function(q){var S=q.getAlarmState().getPropagateSeverity();return S?S.color:q.s("border.color")},Z=ht.widget.TreeView.prototype,Z.getBorderColor=function(v){var V=v.getAlarmState().getPropagateSeverity();return V?V.color:v.s("border.color")},Z.getIcon=function(k){return k.getIcon()?"__alarmIcon__":null},Z=ht.widget.TreeTableView.prototype,Z.getBorderColor=function(C){var q=C.getAlarmState().getPropagateSeverity();return q?q.color:C.s("border.color")},Z.getIcon=function(z){return z.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(V){return V.getIcon()}},color:{func:function(g){var V=g.getAlarmState().getHighestNativeAlarmSeverity();return V?V.color:g.s("body.color")}},rect:[0,0,16,16]}]});var V=ht.Style;V["note2.expanded"]=!0,V["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);